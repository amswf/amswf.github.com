
<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>web游戏 | Amswf&#39;s Home</title>
  <meta name="author" content="John Doe">
  
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  
  <meta property="og:site_name" content="Amswf&#39;s Home"/>

  
    <meta property="og:image" content="undefined"/>
  
  <style>
img{max-width:100%;height:auto;}.alignleft{float:left;}.alignright{float:right;}body{padding-top:70px;background-color:#fff;}.widget ul .icon:before{content:'\f069';color:#4141e9;font:12px FontAwesome;}article footer{padding-top:10px;border-top:1px solid #333;}article a.more-link{padding-right:20px;padding-top:10px;padding-bottom:20px;color:#880088;text-decoration:none;}article header .icon{color:#258fb8;}article .post .icon:before{content:'\f15c';}article .comment .icon:before{content:'\f086';}article .photo .icon:before{content:'\f030';}article .link .icon:before{content:'\f0c1';}article .link .title a:after{content:'\f08e';color:#999;font:12px FontAwesome;padding-left:10px;vertical-align:super;}article .gallery{overflow:hidden;position:relative;}article .gallery:hover .control{opacity:1;-ms-filter:none;filter:none;}article .gallery img{position:absolute;top:0;left:0;opacity:0;-ms-filter:"progid:DXImageTransform.Microsoft.Alpha(Opacity=0)";filter:alpha(opacity=0);}article .gallery .control{opacity:0;-ms-filter:"progid:DXImageTransform.Microsoft.Alpha(Opacity=0)";filter:alpha(opacity=0);-webkit-transition:0.3s;-moz-transition:0.3s;-o-transition:0.3s;-ms-transition:0.3s;transition:0.3s;}article .gallery .prev,article .gallery .next{position:absolute;top:0;width:50%;height:100%;cursor:pointer;}article .gallery .prev:before,article .gallery .next:before{position:absolute;font:24px/1 FontAwesome;text-align:center;width:24px;text-shadow:0 0 15px rgba(0,0,0,0.5);color:#fff;margin-top:-12px;top:50%;}article .gallery .prev{left:0;}article .gallery .prev:before{content:'\f053';left:10px;}article .gallery .next{right:0;}article .gallery .next:before{content:'\f054';right:10px;}article video,article img{min-width:0%;max-width:100%;height:auto;border:none;}.tagcloud .entry a{padding-left:5px;display:inline-block;}
  </style> 
  <link href="/css/test.css" rel="stylesheet"/>
  <link href="/favicon.png" rel="icon">
  <link rel="alternate" href="/atom.xml" title="Amswf&#39;s Home" type="application/atom+xml">
  
  <link rel="stylesheet" href="http://cdn.bootcss.com/twitter-bootstrap/3.0.3/css/bootstrap.min.css" type="text/css">
  <link rel="stylesheet" href="http://cdn.bootcss.com/font-awesome/4.0.3/css/font-awesome.min.css" type="text/css">
  <link rel="stylesheet" href="http://cdn.bootcss.com/prettify/r298/prettify.min.css" type="text/css">
  
  
  
  
  <link rel="stylesheet" href="http://cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.min.css" type="text/css">
  
  
   <style>code{white-space: normal;}</style>
   <script src="/js/respond.min.js"></script>
 </head>


<body>
  <header id="header" class="container inner"><nav id="main-nav" class="navbar navbar-default navbar-fixed-top " role="navigation">
  <div class="container">
    <div class="navbar-header">
      <a class="navbar-brand" href="/">Amswf's Home</a>
    </div>
    <div class="collapse navbar-collapse">
      <ul class="nav navbar-nav">
	
		    <li><a href="/">主页</a></li>
	    
		    <li><a href="/about">关于</a></li>
	    
		    <li><a href="/archives">文章</a></li>
	    
		    <li><a href="/docs">文档</a></li>
	    
      </ul>
      <ul class="nav navbar-nav pull-right">
      
        <li><a href="/atom.xml">RSS</a></li>
            
      
      
      
      
      </ul>
    </div>
  </div>
</nav>
<div class="clearfix"></div></header>
    <div id='content' class="container inner">
       <div class="page-header-wrapper"><div class="page-header"><h1>Amswf's Home <small></small></h1></div></div>
       <div class="row">
         <div id="main-col" class="alignleft col9 col-sm-7 col-md-9 col-lg-9">
	    <section id='header_widget'></section>
	    <div id="wrapper">
<h2 class="archive-title category">web游戏<small><small></h2>


  
    <article>
<div id="master" class="master well">
  
    <div class="gallery">
  <div class="photoset">
    
      <img src="">
    
  </div>
  <div class="control">
    <div class="prev"></div>
    <div class="next"></div>
  </div>
</div>
  
  <div class="post-content">
    <header class="well-sm">
      <i class="fa icon fa-5x pull-left"></i>
      <h1 class="title"><a href="/2014/01/02/2012-09-18-1/">RPG制作之 -- 大地图渲染</a></h1>
      
        <span>Posted on<time datetime="2014-01-02T09:05:10.000Z"> <a href="/2014/01/02/2012-09-18-1/">Jan 2 2014</a></time></span>      
    </header>
    
    <div class="entry">
      
        <h1 id="-3c-center-3e-RPG-5236-4f5c-4e4b-_-2014-_-5927-5730-56fe-6e32-67d3-3c-2f-center-3e-"><center>RPG制作之 — 大地图渲染</center></h1>
<p>大地图的渲染是在小的缩略图渲染之后进行的，于缩略图渲染方式不同的是，大地图渲染需要分块加载，分块渲染。</p>
<object type="application/x-shockwave-flash" width="600" height="400"><br> <param name="movie" value="/static/images/posts/bigMap.swf"/><br> <param name="bgcolor" value="#ffffff"/><br> <embed src="/static/images/posts/bigMap.swf"
        type="application/x-shockwave-flash"
        bgcolor="#ffffff"
        width="600"
        height="400"><br> </embed><br></object>

<pre><code><span class="comment">/**
 * 整个拼合的大图尺寸：3200 * 720
 * 这个地图缩略图尺寸：190 * 42
* 每个tile尺寸是：320 * 360
 * 渲染尺寸：1320 * 720,由于该游戏地图是横版的，所以只在x方向多渲染了一个tile
 */</span>
<span class="package"><span class="keyword">package</span> <span class="title">com</span>.<span class="title">zs</span>
{</span>
<span class="preprocessor"><span class="keyword">import</span> com.zs.utils.MapLoader;</span>
<span class="preprocessor"><span class="keyword">import</span> flash.display.Bitmap;</span>
<span class="preprocessor"><span class="keyword">import</span> flash.display.BitmapData;</span>
<span class="preprocessor"><span class="keyword">import</span> flash.display.Loader;</span>
<span class="preprocessor"><span class="keyword">import</span> flash.display.LoaderInfo;</span>
<span class="preprocessor"><span class="keyword">import</span> flash.display.Shape;</span>
<span class="preprocessor"><span class="keyword">import</span> flash.display.Sprite;</span>
<span class="preprocessor"><span class="keyword">import</span> flash.events.Event;</span>
<span class="preprocessor"><span class="keyword">import</span> flash.geom.Matrix;</span>
<span class="preprocessor"><span class="keyword">import</span> flash.geom.Point;</span>
<span class="preprocessor"><span class="keyword">import</span> flash.geom.Rectangle;</span>
<span class="preprocessor"><span class="keyword">import</span> flash.net.URLRequest;</span>
<span class="preprocessor"><span class="keyword">import</span> flash.utils.setInterval;</span>
<span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BigMapFill</span> <span class="keyword">extends</span> <span class="title">Sprite</span>
{</span>
    <span class="keyword">private</span> <span class="keyword">var</span> _smallMap:BitmapData;
    <span class="comment">/**
     * 地图缓冲区（源地图）
     */</span>
    <span class="keyword">private</span> <span class="keyword">var</span> buffer:BitmapData;
    <span class="keyword">private</span> <span class="keyword">var</span> shape:Bitmap = <span class="keyword">new</span> Bitmap();
    <span class="keyword">private</span> <span class="keyword">var</span> smallMapFilled:Boolean;
    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">BigMapFill</span><span class="params">()</span>
    {</span>
        buffer=<span class="keyword">new</span> BitmapData(<span class="number">1320</span>,<span class="number">720</span>,<span class="literal">false</span>);
        shape.bitmapData = buffer;
        this.addChild(shape);
    }
    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">fillSmallMap</span><span class="params">()</span><span class="type">:Boolean</span>
    {</span>
        <span class="keyword">if</span>(smallMapFilled == <span class="literal">false</span>){
            loadSmallMap();
        }
        <span class="keyword">return</span> smallMapFilled;
    }
    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">fillBigMap</span><span class="params">()</span><span class="type">:void</span>
    {</span>
        <span class="keyword">var</span> i:int = <span class="number">0</span>;
        <span class="keyword">var</span> j:int = <span class="number">0</span>;
        setInterval(<span class="function"><span class="keyword">function</span><span class="params">()</span><span class="type">:void</span>{</span>
            <span class="keyword">if</span>(i&gt;=<span class="number">4</span>){
                i=<span class="number">0</span>;
                j=<span class="number">1</span>;
            }
            <span class="keyword">var</span> loader:MapLoader = <span class="keyword">new</span> MapLoader();
            loader.load(getSwfCatalog()+<span class="string">'/assets/tiles/301/'</span>+j+<span class="string">'_'</span>+i+<span class="string">'.jpg'</span>);
            loader.addEventListener(Event.COMPLETE,onTileLoaded);
            loader.data = {i:i,j:j};
            i ++;
        },<span class="number">1000</span>);
        <span class="comment">/*for(i=0;i&lt;4;i++){
            for(j=0;j&lt;2;j++){
                var loader:MapLoader = new MapLoader();
                loader.load('assets/tiles/301/'+j+'_'+i+'.jpg');
                loader.addEventListener(Event.COMPLETE,onTileLoaded);
                loader.data = {i:i,j:j};
            }
        }*/</span>
    }
    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getSwfCatalog</span><span class="params">()</span><span class="type">:String</span>
    {</span>
        <span class="comment">//通用代码段，获取播放器自身所在的路径 + 补全URL路径字符串以支持相对路径</span>
        <span class="keyword">var</span> playerrealurl:String = <span class="string">""</span>;
        <span class="keyword">var</span> playervarsstr:String = <span class="string">""</span>;
        <span class="keyword">var</span> playerrootpath:String = <span class="string">""</span>;
        loaderInfo.url.indexOf(<span class="string">"?"</span>, <span class="number">0</span>)&gt;=<span class="number">0</span> ? playerrealurl=loaderInfo.url.slice(<span class="number">0</span>, loaderInfo.url.indexOf(<span class="string">"?"</span>, <span class="number">0</span>)) : playerrealurl=loaderInfo.url;
        loaderInfo.url.indexOf(<span class="string">"?"</span>, <span class="number">0</span>)&gt;=<span class="number">0</span> ? playervarsstr=loaderInfo.url.slice(loaderInfo.url.indexOf(<span class="string">"?"</span>, <span class="number">0</span>)+<span class="number">1</span>) : playervarsstr=<span class="string">""</span>;
        playerrealurl.lastIndexOf(<span class="string">"/"</span>, playerrealurl.length)&gt;=<span class="number">0</span> ? playerrootpath=playerrealurl.slice(<span class="number">0</span>, playerrealurl.lastIndexOf(<span class="string">"/"</span>, playerrealurl.length)) : playerrootpath=<span class="string">""</span>;
        <span class="keyword">return</span> playerrootpath;
    }
    <span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">onTileLoaded</span><span class="params">(e:Event)</span><span class="type">:void</span>
    {</span>
        <span class="keyword">var</span> rect:Rectangle = <span class="keyword">new</span> Rectangle(<span class="number">0</span>,<span class="number">0</span>,<span class="number">320</span>,<span class="number">360</span>);
        <span class="keyword">var</span> point:Point = <span class="keyword">new</span> Point(MapLoader(e.target).data.i*<span class="number">320</span>,MapLoader(e.target).data.j * <span class="number">360</span>);
        buffer.lock();
        buffer.copyPixels(Bitmap(MapLoader(e.target).content).bitmapData,rect,point);
        buffer.unlock();
    }
    <span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">loadSmallMap</span><span class="params">()</span><span class="type">:void</span>
    {</span>
        <span class="keyword">var</span> loader:Loader = <span class="keyword">new</span> Loader();
        loader.contentLoaderInfo.addEventListener(Event.COMPLETE,smallMapLoaded);
        loader.load(<span class="keyword">new</span> URLRequest(<span class="string">'assets/s.jpg'</span>));
    }
    <span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">smallMapLoaded</span><span class="params">(e:Event)</span><span class="type">:void</span>
    {</span>
        <span class="keyword">var</span> loadinfo:LoaderInfo = e.target <span class="keyword">as</span> LoaderInfo;
        _smallMap = (loadinfo.content <span class="keyword">as</span> Bitmap).bitmapData;
        <span class="keyword">var</span> per:Number = <span class="number">3200</span>/_smallMap.width;
        buffer.draw(_smallMap,<span class="keyword">new</span> Matrix(per,<span class="number">0</span>,<span class="number">0</span>,per),<span class="literal">null</span>,<span class="literal">null</span>,<span class="literal">null</span>,<span class="literal">true</span>);
        smallMapFilled = <span class="literal">true</span>;
    }
}
}
</code></pre><p>地图加载器：</p>
<pre><code><span class="package"><span class="keyword">package</span> <span class="title">com</span>.<span class="title">zs</span>.<span class="title">utils</span>
{</span>
<span class="preprocessor"><span class="keyword">import</span> flash.display.DisplayObject;</span>
<span class="preprocessor"><span class="keyword">import</span> flash.display.Loader;</span>
<span class="preprocessor"><span class="keyword">import</span> flash.display.LoaderInfo;</span>
<span class="preprocessor"><span class="keyword">import</span> flash.events.Event;</span>
<span class="preprocessor"><span class="keyword">import</span> flash.events.EventDispatcher;</span>
<span class="preprocessor"><span class="keyword">import</span> flash.events.IOErrorEvent;</span>
<span class="preprocessor"><span class="keyword">import</span> flash.net.URLRequest;</span>
[Event(name=<span class="string">'COMPLETE'</span>,type=<span class="string">'flash.events.Event'</span>)]
<span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MapLoader</span> <span class="keyword">extends</span> <span class="title">EventDispatcher</span>
{</span>
    <span class="keyword">public</span> <span class="keyword">var</span> data:Object = {};
    <span class="keyword">private</span> <span class="keyword">var</span> _content:DisplayObject;
    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">MapLoader</span><span class="params">()</span>
    {</span>
    }
    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">load</span><span class="params">(url:String)</span><span class="type">:MapLoader</span>
    {</span>
        <span class="keyword">var</span> loader:Loader = <span class="keyword">new</span> Loader();
        loader.contentLoaderInfo.addEventListener(Event.COMPLETE,onLoaded);
        loader.contentLoaderInfo.addEventListener(IOErrorEvent.IO_ERROR,onError);
        loader.load(<span class="keyword">new</span> URLRequest(url));
        <span class="keyword">return</span> <span class="keyword">this</span>;
    }
    <span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">onError</span><span class="params">(e:IOErrorEvent)</span><span class="type">:void</span>
    {</span>
        LoaderInfo(e.target).loader.removeEventListener(Event.COMPLETE,onLoaded);
        LoaderInfo(e.target).loader.removeEventListener(IOErrorEvent.IO_ERROR,onError);
    }
    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">get</span> <span class="title">content</span><span class="params">()</span><span class="type">:DisplayObject</span>
    {</span>
        <span class="keyword">return</span> _content;
    }
    <span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">onLoaded</span><span class="params">(e:Event)</span><span class="type">:void</span>
    {</span>
        LoaderInfo(e.target).loader.removeEventListener(Event.COMPLETE,onLoaded);
        LoaderInfo(e.target).loader.removeEventListener(IOErrorEvent.IO_ERROR,onError);
        _content = LoaderInfo(e.target).content;
        this.dispatchEvent(<span class="keyword">new</span> Event(Event.COMPLETE));
    }
}
}
</code></pre><p>使用：</p>
<pre><code><span class="package"><span class="keyword">package</span>
{</span>
<span class="preprocessor"><span class="keyword">import</span> com.zs.BigMapFill;</span>
<span class="preprocessor"><span class="keyword">import</span> flash.display.Sprite;</span>
<span class="preprocessor"><span class="keyword">import</span> flash.events.Event;</span>
<span class="preprocessor"><span class="keyword">import</span> flash.events.MouseEvent;</span>

[SWF(width=<span class="string">'600'</span>,height=<span class="string">'400'</span>)]
<span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Main</span> <span class="keyword">extends</span> <span class="title">Sprite</span>
{</span>
    <span class="keyword">private</span> <span class="keyword">var</span> map:BigMapFill = <span class="keyword">new</span> BigMapFill();
    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">Main</span><span class="params">()</span>
    {</span>
        this.addEventListener(Event.ADDED_TO_STAGE,init);
    }
    <span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">init</span><span class="params">(e:Event)</span><span class="type">:void</span>
    {</span>
        this.stage.align = <span class="string">'TL'</span>;
        this.stage.scaleMode = <span class="string">'noScale'</span>;
        this.stage.addEventListener(MouseEvent.CLICK,onStart);
        this.addChild(map);
    }
    <span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">onStart</span><span class="params">(event:MouseEvent)</span><span class="type">:void</span>
    {</span>
        <span class="keyword">if</span>(map.fillSmallMap()){
            map.fillBigMap();
        }
    }
}
}
</code></pre>
      
    </div>
    
    
      
    
    
        <footer id="post-meta">
        <span class="categories breadcrumb">Posted in <li><a href="/categories/web游戏/">web游戏</a></li></span> | <span class="time">updated:<time datetime="Jan 2 2014"> Jan 2 2014</time></span> | <span class="comment-link">
<a href="http://amswf.com/2014/01/02/2012-09-18-1/#comments" id="uyan_count_unit" su="2012-09-18-1">暂无评论</a>
</span>
        </footer>
        <div class="clearfix"></div>
    
  </div>
</div>
</article>


  
    <article>
<div id="master" class="master well">
  
    <div class="gallery">
  <div class="photoset">
    
      <img src="">
    
  </div>
  <div class="control">
    <div class="prev"></div>
    <div class="next"></div>
  </div>
</div>
  
  <div class="post-content">
    <header class="well-sm">
      <i class="fa icon fa-5x pull-left"></i>
      <h1 class="title"><a href="/2014/01/02/2012-09-17-1/">RPG制作之 -- 小地图渲染</a></h1>
      
        <span>Posted on<time datetime="2014-01-02T09:05:05.000Z"> <a href="/2014/01/02/2012-09-17-1/">Jan 2 2014</a></time></span>      
    </header>
    
    <div class="entry">
      
        <h1 id="-3c-center-3e-RPG-5236-4f5c-4e4b-_-2014-_-5c0f-5730-56fe-6e32-67d3-3c-2f-center-3e-"><center>RPG制作之 — 小地图渲染</center></h1>
<p>地图渲染分两步：</p>
<ul>
<li><p>使用缩略图渲染</p>
</li>
<li><p>加载tile，分块渲染</p>
</li>
</ul>
<p>名词解释：</p>
<ul>
<li>整地图：游戏要使用的整张地图</li>
</ul>
<ul>
<li><p>tile：由于整张地图比较大，要是每次都全部渲染，会浪费内存，所以采取分块渲染。分块渲染时将一整张地图按相同大小分成等份。</p>
</li>
<li><p>缩略图：对于整张地图的等比缩放，常用来在地图渲染中用来初始化具体需要渲染的tile。等具体tile下载完毕后，可供渲染时，才具体将tile渲染到对应地方。这就是我们常在游戏中看到的，地图刚开始是马赛克效果，然后会逐渐清晰。</p>
</li>
</ul>
<object type="application/x-shockwave-flash" width="500" height="400"><br> <param name="movie" value="/static/images/posts/scaleMap.swf"/><br> <param name="bgcolor" value="#ffffff"/><br> <embed src="/static/images/posts/scaleMap.swf"
        type="application/x-shockwave-flash"
        bgcolor="#ffffff"
        width="500"
        height="400"><br> </embed><br></object>

<p>本文先讲解小地图渲染：<br>    package com.zs<br>    {<br>    import flash.display.Bitmap;<br>    import flash.display.BitmapData;<br>    import flash.display.Loader;<br>    import flash.display.LoaderInfo;<br>    import flash.display.Shape;<br>    import flash.display.Sprite;<br>    import flash.events.Event;<br>    import flash.geom.Matrix;<br>    import flash.geom.Point;<br>    import flash.geom.Rectangle;<br>    import flash.net.URLRequest;<br>    public class SmallMapFill extends Sprite<br>    {<br>        private var _smallMap:BitmapData;<br>        protected var _scache:BitmapData;<br>        /**</p>
<pre><code>     * 地图缓冲区（源地图）
     */
    <span class="keyword">private</span> <span class="keyword">var</span> buffer:BitmapData;
    <span class="keyword">private</span> <span class="keyword">var</span> shape:Bitmap = <span class="keyword">new</span> Bitmap();
    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">SmallMapFill</span><span class="params">()</span>
    {</span>
        this.addChild(shape);
    }
    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">init</span><span class="params">()</span><span class="type">:void</span>
    {</span>
        loadSmallMap();
    }
    <span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">loadSmallMap</span><span class="params">()</span><span class="type">:void</span>
    {</span>
        <span class="keyword">var</span> loader:Loader = <span class="keyword">new</span> Loader();
        loader.contentLoaderInfo.addEventListener(Event.COMPLETE,smallMapLoaded);
        loader.load(<span class="keyword">new</span> URLRequest(<span class="string">'assets/s.jpg'</span>));
    }
    <span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">smallMapLoaded</span><span class="params">(e:Event)</span><span class="type">:void</span>
    {</span>
        <span class="keyword">var</span> loadinfo:LoaderInfo = e.target <span class="keyword">as</span> LoaderInfo;
        _smallMap = (loadinfo.content <span class="keyword">as</span> Bitmap).bitmapData;
        buffer=<span class="keyword">new</span> BitmapData(<span class="number">1320</span>,<span class="number">720</span>,<span class="literal">false</span>);
        <span class="keyword">var</span> per:Number = <span class="number">3200</span>/_smallMap.width;
        buffer.draw(_smallMap,<span class="keyword">new</span> Matrix(per,<span class="number">0</span>,<span class="number">0</span>,per),<span class="literal">null</span>,<span class="literal">null</span>,<span class="literal">null</span>,<span class="literal">true</span>);
        shape.bitmapData = buffer;
    }
}
}
</code></pre><p>使用代码：</p>
<pre><code><span class="package"><span class="keyword">package</span>
{</span>
<span class="preprocessor"><span class="keyword">import</span> com.zs.SmallMapFill;</span>
<span class="preprocessor"><span class="keyword">import</span> flash.display.LoaderInfo;</span>
<span class="preprocessor"><span class="keyword">import</span> flash.display.Sprite;</span>
<span class="preprocessor"><span class="keyword">import</span> flash.events.Event;</span>
<span class="preprocessor"><span class="keyword">import</span> flash.events.MouseEvent;</span>

[SWF(width=<span class="string">'500'</span>,height=<span class="string">'400'</span>,backgroundColor=<span class="string">'0xcccccc'</span>)]
<span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Main</span> <span class="keyword">extends</span> <span class="title">Sprite</span>
{</span>
    <span class="keyword">private</span> <span class="keyword">var</span> map:SmallMapFill = <span class="keyword">new</span> SmallMapFill();
    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">Main</span><span class="params">()</span>
    {</span>
        this.addEventListener(Event.ADDED_TO_STAGE,init);
    }
    <span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">init</span><span class="params">(e:Event)</span><span class="type">:void</span>
    {</span>
        this.stage.align = <span class="string">'TL'</span>;
        this.stage.scaleMode = <span class="string">'noScale'</span>;
        this.stage.addEventListener(MouseEvent.CLICK,onStart);
        this.addChild(map);
    }
    <span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">onStart</span><span class="params">(e:Event)</span><span class="type">:void</span>
    {</span>
        map.init();
    }
}
}
</code></pre>
      
    </div>
    
    
      
    
    
        <footer id="post-meta">
        <span class="categories breadcrumb">Posted in <li><a href="/categories/web游戏/">web游戏</a></li></span> | <span class="time">updated:<time datetime="Jan 2 2014"> Jan 2 2014</time></span> | <span class="comment-link">
<a href="http://amswf.com/2014/01/02/2012-09-17-1/#comments" id="uyan_count_unit" su="2012-09-17-1">暂无评论</a>
</span>
        </footer>
        <div class="clearfix"></div>
    
  </div>
</div>
</article>


  
    <article>
<div id="master" class="master well">
  
    <div class="gallery">
  <div class="photoset">
    
      <img src="">
    
  </div>
  <div class="control">
    <div class="prev"></div>
    <div class="next"></div>
  </div>
</div>
  
  <div class="post-content">
    <header class="well-sm">
      <i class="fa icon fa-5x pull-left"></i>
      <h1 class="title"><a href="/2014/01/02/2012-09-16-1/">RPG制作之 -- 人物动作渲染</a></h1>
      
        <span>Posted on<time datetime="2014-01-02T09:04:59.000Z"> <a href="/2014/01/02/2012-09-16-1/">Jan 2 2014</a></time></span>      
    </header>
    
    <div class="entry">
      
        <h1 id="-3c-center-3e-RPG-5236-4f5c-4e4b-_-2014-_-4eba-7269-52a8-4f5c-6e32-67d3-3c-2f-center-3e-"><center>RPG制作之 — 人物动作渲染</center></h1>
<p>动作渲染有两种方式，一种是flash的movieclip方式，一种是块传输技术（spritesheet），这两种方式各有利弊。使用movieclip方式优点是：制作方便，缺点是：由于所有动作都基于movieclip类渲染，这样会浪费内存和cpu资源。而spritesheet的优缺点和movieclip正好相反。为了让用户的游戏体验更好，flash在制作大型游戏，一般都选用spritesheet方式。</p>
<object type="application/x-shockwave-flash" width="105" height="120"><br> <param name="movie" value="/static/images/posts/sheet.swf"/><br> <param name="bgcolor" value="#ffffff"/><br> <embed src="/static/images/posts/sheet.swf"
        type="application/x-shockwave-flash"
        bgcolor="#ffffff"
        width="105"
        height="120"><br> </embed><br></object>

<p><a href="https://gist.github.com/41500281261d4bcb6d12" target="_blank">源码</a></p>
<pre><code><span class="package"><span class="keyword">package</span> <span class="title">com</span>.<span class="title">zs</span>.<span class="title">utils</span>
{</span>
<span class="preprocessor"><span class="keyword">import</span> flash.display.Bitmap;</span>
<span class="preprocessor"><span class="keyword">import</span> flash.display.BitmapData;</span>
<span class="preprocessor"><span class="keyword">import</span> flash.display.Loader;</span>
<span class="preprocessor"><span class="keyword">import</span> flash.display.LoaderInfo;</span>
<span class="preprocessor"><span class="keyword">import</span> flash.events.Event;</span>
<span class="preprocessor"><span class="keyword">import</span> flash.events.IOErrorEvent;</span>
<span class="preprocessor"><span class="keyword">import</span> flash.geom.Point;</span>
<span class="preprocessor"><span class="keyword">import</span> flash.geom.Rectangle;</span>
<span class="preprocessor"><span class="keyword">import</span> flash.net.URLRequest;</span>
<span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SheetMoive</span> <span class="keyword">extends</span> <span class="title">Bitmap</span>
{</span>
    <span class="keyword">private</span> <span class="keyword">var</span> sheets:Object = {};
    <span class="keyword">private</span> <span class="keyword">var</span> action:String;
    <span class="keyword">private</span> <span class="keyword">var</span> actionW:Number = <span class="number">105</span>;
    <span class="keyword">private</span> <span class="keyword">var</span> actionH:Number = <span class="number">120</span>;
    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">SheetMoive</span><span class="params">(w:Number=105,h:Number=120)</span>
    {</span>
        this.bitmapData = <span class="keyword">new</span> BitmapData(actionW,actionH);
    }
    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">addSheet</span><span class="params">(url:String,action:String)</span><span class="type">:void</span>
    {</span>
        <span class="keyword">var</span> loader:Loader = <span class="keyword">new</span> Loader();
        loader.contentLoaderInfo.addEventListener(Event.COMPLETE,onLoaded);
        loader.contentLoaderInfo.addEventListener(IOErrorEvent.IO_ERROR,onError);
        loader.name = action;
        loader.load(<span class="keyword">new</span> URLRequest(url));
    }
    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">go</span><span class="params">(action:String)</span><span class="type">:Boolean</span>
    {</span>
        <span class="keyword">if</span>(sheets[action]){
            this.action = action;
            this.addEventListener(Event.ENTER_FRAME,render);
            <span class="keyword">return</span> <span class="literal">true</span>;
        }
        <span class="keyword">return</span> <span class="literal">false</span>;
    }
    <span class="keyword">private</span> <span class="keyword">var</span> sheetIndex:int = <span class="number">0</span>;
    <span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">render</span><span class="params">(e:Event)</span><span class="type">:void</span>
    {</span>
        <span class="keyword">if</span>(sheetIndex &gt;= sheets[action].sheetNum){
            sheetIndex = <span class="number">0</span>;
        }
        this.bitmapData.lock();
        this.bitmapData.copyPixels(sheets[action].pic,<span class="keyword">new</span> Rectangle(sheetIndex * actionW,<span class="number">0</span>,actionW,actionH),<span class="keyword">new</span> Point(<span class="number">0</span>,<span class="number">0</span>));
        this.bitmapData.unlock();
        sheetIndex++;
    }
    <span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">onError</span><span class="params">(e:IOErrorEvent)</span><span class="type">:void</span>
    {</span>
    }
    <span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">onLoaded</span><span class="params">(e:Event)</span><span class="type">:void</span>
    {</span>
        <span class="keyword">var</span> loader:Loader = LoaderInfo(e.target).loader;
        <span class="keyword">var</span> bitmapdata:BitmapData = (loader.content <span class="keyword">as</span> Bitmap).bitmapData;
        sheets[loader.name] = {pic:bitmapdata,sheetNum:Math.floor(bitmapdata.width/<span class="number">105</span>)};
        this.dispatchEvent(<span class="keyword">new</span> Event(<span class="string">'done'</span>));
    }
}
}
</code></pre><p>引用：<br>    package<br>    {<br>    import com.zs.utils.SheetMoive;<br>    import flash.display.LoaderInfo;<br>    import flash.display.Sprite;<br>    import flash.events.Event;<br>    import flash.events.MouseEvent;</p>
<pre><code>[SWF(width=<span class="string">'105'</span>,height=<span class="string">'120'</span>,backgroundColor=<span class="string">'0xcccccc'</span>)]
<span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Main</span> <span class="keyword">extends</span> <span class="title">Sprite</span>
{</span>
    <span class="keyword">private</span> <span class="keyword">var</span> ren:SheetMoive = <span class="keyword">new</span> SheetMoive();
    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">Main</span><span class="params">()</span>
    {</span>
        this.addEventListener(Event.ADDED_TO_STAGE,init);
    }
    <span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">init</span><span class="params">(e:Event)</span><span class="type">:void</span>
    {</span>
        this.stage.align = <span class="string">'TL'</span>;
        this.stage.scaleMode = <span class="string">'noScale'</span>;
        this.stage.addEventListener(MouseEvent.CLICK,changeAction);
        this.addChild(ren);
        ren.addSheet(<span class="string">'/assets/character/walk.png'</span>,<span class="string">'walk'</span>);
        ren.addSheet(<span class="string">'/assets/character/stand.png'</span>,<span class="string">'stand'</span>);
        ren.addEventListener(<span class="string">'done'</span>,onStart);
    }
    <span class="keyword">private</span> <span class="keyword">var</span> change:Boolean;
    <span class="keyword">protected</span> <span class="function"><span class="keyword">function</span> <span class="title">changeAction</span><span class="params">(event:MouseEvent)</span><span class="type">:void</span>
    {</span>
        <span class="keyword">if</span>(change){
            ren.go(<span class="string">'stand'</span>);
        }<span class="keyword">else</span>{
            ren.go(<span class="string">'walk'</span>);
        }
        change = !change;
    }
    <span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">onStart</span><span class="params">(e:Event)</span><span class="type">:void</span>
    {</span>
        ren.go(<span class="string">'walk'</span>);
    }
}
}
</code></pre>
      
    </div>
    
    
      
    
    
        <footer id="post-meta">
        <span class="categories breadcrumb">Posted in <li><a href="/categories/web游戏/">web游戏</a></li></span> | <span class="time">updated:<time datetime="Jan 2 2014"> Jan 2 2014</time></span> | <span class="comment-link">
<a href="http://amswf.com/2014/01/02/2012-09-16-1/#comments" id="uyan_count_unit" su="2012-09-16-1">暂无评论</a>
</span>
        </footer>
        <div class="clearfix"></div>
    
  </div>
</div>
</article>


  

  
</div><!--wapper-->
         </div><!-- ID main-col END -->
         <div id="sidebar well-sm" class="alignright col3 col-sm-5 col-md-3 col-lg-3">
<div id="widget_search" class="widget panel panel-primary">
    <div class="panel-heading">Search</div>    <form action="//google.com/search" method="get" accept-charset="utf-8">
  <div class="input-group">
    <input class="form-control" id="searchbox" type="search" name="q" results="0" placeholder="Search">
    <span class="input-group-btn">
      <button class="btn btn-default" type="submit">Go!</button>
    </span>
    <input type="hidden" name="q" value="site:amswf.com">
  </div>
</form>
</div>

<div id="widget_category" class="widget panel panel-primary">
    <div class="panel-heading">category</div>    
<ul class="list-group"><li class="list-group-item"><span class="badge">2</span><a href="/categories/Actionscript/">Actionscript</a></li><li class="list-group-item"><span class="badge">1</span><a href="/categories/cocos2dx/">cocos2dx</a></li><li class="list-group-item"><span class="badge">1</span><a href="/categories/github/">github</a></li><li class="list-group-item"><span class="badge">1</span><a href="/categories/javascript/">javascript</a></li><li class="list-group-item"><span class="badge">3</span><a href="/categories/web游戏/">web游戏</a></li><li class="list-group-item"><span class="badge">6</span><a href="/categories/杂七杂八/">杂七杂八</a></li></ul></div>

<div id="widget_recent_posts" class="widget panel panel-primary">
    <div class="panel-heading">Recent Posts</div>    
<ul class="list-group"><li class="list-group-item icon"><a href="/2014/01/02/2013-11-17-1/">flash安全域和程序域的一点见解</a></li><li class="list-group-item icon"><a href="/2014/01/02/2013-10-31-1/">js类相关概念梳理</a></li><li class="list-group-item icon"><a href="/2014/01/02/2013-09-30-1/">cocos2dx-html5基础教程</a></li><li class="list-group-item icon"><a href="/2014/01/02/2013-09-04-1/">破解版flashfirebug4.45不能用的解决办法</a></li><li class="list-group-item icon"><a href="/2014/01/02/2013-03-27-1/">flashdevelop的几个优点</a></li></ul>
</div>

<div id="widget_recent_comments" class="widget panel panel-primary">
    <div class="panel-heading">recent_comments</div>    

<div id="uyan_newcmt_unit"></div>



</div>
</div>
         <div class="clearfix"></div>
       </div><!-- row END -->
    </div>
    <footer id="footer" class="container">
    <div class="panel panel-info">
    <section id='footer_widget'></section>    <div class="panel-footer">
  <div id="site-info">
    <span class='author'>
  
  &copy; 2014 John Doe
  
    </span>
  <span id='analytics-cnzz'>
<script type="text/javascript">var cnzz_protocol = (("https:" == document.location.protocol) ? " https://" : " http://");document.write(unescape("%3Cspan id='cnzz_stat_icon_4567281'%3E%3C/span%3E%3Cscript src='" + cnzz_protocol + "s17.cnzz.com/stat.php%3Fid%3D4567281%26show%3Dpic' type='text/javascript'%3E%3C/script%3E"));</script>
</span>  </div>
  <div id="copyright">Blog powered by <a href='http://zespia.tw/hexo/'><strong>hexo</strong></a> Theme <strong><a href='https://github.com/chenall/hexo-theme-chenall'>chenall</a></div>
</div>
<div class="clearfix"></div>


    </div>
    </footer>
    
        <script src="http://cdn.bootcss.com/jquery/1.10.2/jquery.min.js"></script>
        
        <script src="http://cdn.bootcss.com/twitter-bootstrap/3.0.3/js/bootstrap.min.js"></script>
        
        
        
        <script src="http://cdn.bootcss.com/prettify/r298/prettify.min.js"></script>
    <script type="text/javascript">
$(window).load(function(){
   $("pre").addClass("prettyprint");
   prettyPrint();
})
</script>    
        <script src="/js/jquery.imagesloaded.min.js"></script>
        
        
    <script type="text/javascript">
var uyan_config={
     'url':'http://amswf.com/categories/web游戏/',
'su':'2012-09-16-1'
};
</script>
<script type="text/javascript" src="http://v2.uyan.cc/code/uyan.js?uid=1678356"></script>
    
        
    <!--wumii_relatedItems-->
    
        
    
<script type="text/javascript">var ujian_config = {num:6,showType:0,picSize:84,textHeight:45};</script>
<script type="text/javascript" src="http://v1.ujian.cc/code/ujian.js?uid=1678356"></script>
<a href="http://www.ujian.cc" style="border:0;"><img src="http://img.ujian.cc/pixel.png" alt="友荐云推荐" style="border:0;padding:0;margin:0;" /></a>
    
        <script src="http://cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.min.js"></script>
    <script src="/js/gallery.js"></script>
<script type="text/javascript">
(function($){
  $('.fancybox').fancybox();
})(jQuery);
</script>    
        <script src="http://cdn.bootcss.com/mathjax/2.3/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    tex2jax: {
      inlineMath: [ ['$','$'], ["\\(","\\)"] ],
      processEscapes: true
    }
  });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      tex2jax: {
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
      }
    });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for(i=0; i < all.length; i += 1) {
            all[i].SourceElement().parentNode.className += ' has-jax';
        }
    });
</script>    

</body>
</html>