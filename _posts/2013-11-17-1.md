---
layout: master
title: flash安全域和程序域的一点见解

---

#<center>flash安全域和程序域的一点见解</center>

前两天朋友问我安全域和程序域的问题，这个问题我之前也查过，网上大多数文章要么很长要么讲解的不详细，看了后还是一头雾水。所以我就想自己写一篇关于这方面的文章。力求简洁而全面。

1.安全域
先来说安全域，这个东西通过名字也能理解意思，就是用来解决不同域名下flash文件访问和通信安全。这分两种情况。

(一)文件访问安全：

js和flash接口调用：通过flash里面设置Security.allowDomain('*');
flash加载swf调用接口：
1）子swf信任父swf：通过子swf里面设置Security.allowDomain('*')，这种情况子虽然信任了父，但是子和父仍然位于两个不同的域中;

2）父swf信任子swf：可以在LoaderContext 中设置子的安全域和自己的安全域相同，这种情况子完全在父的域中，父子同域。

两个swf通过localconnection通信：Security.allowDomain('*');
(二)服务访问安全：

1)flash和php后台的通信：通过服务器配置跨域访问文件crossdomain.xml来解决，这种情况如果crossdomain如果没允许其他域名的访问，其他域名的flash调用这个php服务会直接报错的。
2)flash和socket后台的通信：通过843端口放置跨域服务解决。这种情况下，如果后台没有相应的跨域服务，flash建立长连接会直接报错。


2.程序域
讲之前需要说明的是，不同的安全域，程序域必然不同。相同的安全域下才可以对程序域进行设置以达到不同的效果。那么程序域用来干嘛的呢，他是用来设置父子之间对类的访问。
比如：a.swf和b.swf位于相同安全域下面。a.swf和b.swf里面都有com.amswf.game.as这个文件。那么当a.swf加载了b.swf后会是什么情况呢。我大概看了下手册发现讲的已经很明确，所以直接抄录了下来。

* 加载器的 ApplicationDomain 的子级。默认值。可以使用语法 new ApplicationDomain(ApplicationDomain.currentDomain) 显式表示这种选择。这将允许所加载的 SWF 文件直接使用父级的类，例如，可通过编写 new MyClassDefinedInParent() 来使用。但是父级则不能使用此语法；如果父级要使用子级的类，它必须调用 ApplicationDomain.getDefinition() 来检索它们。这种选择的优点是，如果子级定义的类与父级已经定义的类同名，不会出现错误结果；子级只会继承父级对该类的定义，除非子级或父级调用 ApplicationDomain.getDefinition() 方法来检索子级的冲突定义，否则将不使用此定义。

* 加载器自己的 ApplicationDomain。使用 ApplicationDomain.currentDomain 时请使用此应用程序域。加载完成后，父级和子级可以直接使用对方的类。如果子级试图定义的类与父级已定义的类同名，则使用父类并忽略子类。

* 系统 ApplicationDomain 的子级。使用 new ApplicationDomain(null) 时请使用此应用程序域。这将完全分离加载方和被加载方，从而允许它们使用相同的名称定义各自版本的类并且不会产生冲突或隐藏。一方查看另一方的类的唯一方式是调用 ApplicationDomain.getDefinition() 方法。

* 其他 ApplicationDomain 的子级。有时可能会有更复杂的 ApplicationDomain 层次结构。可以将 SWF 文件从您自己的 SecurityDomain 加载到任何 ApplicationDomain 中。例如，new ApplicationDomain(ApplicationDomain.currentDomain.parentDomain.parentDomain) 将 SWF 文件加载到当前域父级的父级的新子级中。


这里只要明确三个概念，就能明白其中的道理。这三个概念是，加载器的程序域，系统的程序域，子级。